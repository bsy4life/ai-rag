<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#d97706">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="icon" type="image/png" sizes="192x192" href="/frontend/icon/icon-192.png">
  <link rel="apple-touch-icon" href="/frontend/icon/icon-192.png">
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  
  <script>
    tailwind.config = { 
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            claude: {
              50: '#fffbeb', 100: '#fef3c7', 200: '#fde68a', 300: '#fcd34d',
              400: '#fbbf24', 500: '#d97706', 600: '#b45309', 700: '#92400e',
              800: '#78350f', 900: '#451a03',
            },
            sand: {
              50: '#fafaf9', 100: '#f5f5f4', 200: '#e7e5e4', 300: '#d6d3d1',
              400: '#a8a29e', 500: '#78716c', 600: '#57534e', 700: '#44403c',
              800: '#292524', 900: '#1c1917',
            }
          },
          fontFamily: {
            sans: ['Noto Sans TC', 'system-ui', 'sans-serif'],
            mono: ['JetBrains Mono', 'monospace'],
          }
        }
      }
    }
  </script>
  
  <title>SanShin AI</title>
  
  <style>
    html, body { height: 100%; overflow: hidden; }
    body { font-family: 'Noto Sans TC', system-ui, sans-serif; }
    
    /* å´é‚Šæ¬„ */
    #sidebar { 
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    @media (max-width: 768px) {
      #sidebar { width: 280px !important; }
    }
    
    /* å°è©±é …ç›® */
    .chat-item {
      transition: all 0.2s ease;
      border-radius: 10px;
      padding: 10px 12px;
      margin: 2px 8px;
      cursor: pointer;
      border-left: 3px solid transparent;
    }
    .chat-item:hover { background: rgba(217, 119, 6, 0.08); }
    .chat-item.active {
      background: rgba(217, 119, 6, 0.12);
      border-left-color: #d97706;
    }
    .dark .chat-item:hover { background: rgba(217, 119, 6, 0.15); }
    .dark .chat-item.active { background: rgba(217, 119, 6, 0.2); }
    
    /* è¨Šæ¯æ°£æ³¡ */
    .message-bubble { animation: slideIn 0.3s ease-out; }
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .user-bubble {
      background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
      color: white;
      border-radius: 18px 18px 4px 18px;
      box-shadow: 0 2px 8px rgba(217, 119, 6, 0.25);
    }
    
    .ai-bubble {
      background: white;
      border: 1px solid #e7e5e4;
      border-radius: 18px 18px 18px 4px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.04);
    }
    .dark .ai-bubble {
      background: #292524;
      border-color: #44403c;
    }
    
    /* è¼¸å…¥å€åŸŸ */
    .input-wrapper {
      background: white;
      border: 2px solid #e7e5e4;
      border-radius: 20px;
      transition: all 0.2s ease;
    }
    .input-wrapper:focus-within {
      border-color: #d97706;
      box-shadow: 0 0 0 3px rgba(217, 119, 6, 0.1);
    }
    .dark .input-wrapper {
      background: #292524;
      border-color: #44403c;
    }
    .dark .input-wrapper:focus-within {
      border-color: #d97706;
      box-shadow: 0 0 0 3px rgba(217, 119, 6, 0.2);
    }
    
    /* æ¨¡å¼é¸æ“‡å™¨ - ä¿®æ­£ç‰ˆ */
    .mode-selector {
      display: inline-flex;
      gap: 4px;
      padding: 4px;
      background: #f5f5f4;
      border-radius: 12px;
    }
    .dark .mode-selector { background: #44403c; }
    
    .mode-btn {
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      color: #78716c;
      background: transparent;
      border: none;
      white-space: nowrap;
    }
    .mode-btn:hover {
      color: #d97706;
      background: rgba(217, 119, 6, 0.08);
    }
    .mode-btn.active {
      background: white;
      color: #d97706;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .dark .mode-btn { color: #a8a29e; }
    .dark .mode-btn.active {
      background: #57534e;
      color: #fbbf24;
    }
    
    /* è¼‰å…¥å‹•ç•« */
    .typing-dots { display: flex; gap: 4px; padding: 4px 0; }
    .typing-dot {
      width: 8px; height: 8px;
      background: #d97706;
      border-radius: 50%;
      animation: bounce 1.4s ease-in-out infinite;
    }
    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }
    @keyframes bounce {
      0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
      30% { transform: translateY(-6px); opacity: 1; }
    }
    
    /* Markdown æ¨£å¼ */
    .md-content .table-wrapper {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      margin: 12px 0;
      border-radius: 8px;
      border: 1px solid #e7e5e4;
    }
    .dark .md-content .table-wrapper { border-color: #44403c; }
    .md-content table {
      border-collapse: collapse; width: 100%; min-width: 400px;
      font-size: 14px;
    }
    @media (max-width: 640px) {
      .md-content table { font-size: 12px; min-width: 320px; }
      .md-content th, .md-content td { padding: 8px 10px; }
    }
    .md-content th, .md-content td {
      border: 1px solid #e7e5e4; padding: 10px 12px; text-align: left;
      white-space: nowrap;
    }
    .md-content td:last-child, .md-content th:last-child {
      white-space: normal; /* æœ€å¾Œä¸€æ¬„å¯æ›è¡Œ */
    }
    .dark .md-content th, .dark .md-content td { border-color: #44403c; }
    .md-content th {
      background: #fef3c7; font-weight: 600; color: #78350f;
    }
    .dark .md-content th { background: #44403c; color: #fde68a; }
    .md-content tr:nth-child(even) { background: rgba(0,0,0,0.02); }
    .dark .md-content tr:nth-child(even) { background: rgba(255,255,255,0.02); }
    .md-content h2 { font-size: 1.1rem; font-weight: 600; color: #d97706; margin: 16px 0 8px; }
    .md-content h3 { font-size: 1rem; font-weight: 600; margin: 12px 0 6px; }
    .dark .md-content h2 { color: #fbbf24; }
    .md-content code {
      background: rgba(217,119,6,0.1); color: #b45309;
      padding: 2px 6px; border-radius: 4px; font-family: 'JetBrains Mono', monospace;
    }
    .dark .md-content code { background: rgba(217,119,6,0.2); color: #fbbf24; }
    .md-content ul, .md-content ol { margin: 8px 0; padding-left: 20px; }
    .md-content li { margin: 4px 0; line-height: 1.5; }
    .md-content p { margin: 8px 0; line-height: 1.6; }
    
    /* ä¾†æºæ¨™ç±¤ */
    .src-tag {
      display: inline-flex; align-items: center; gap: 4px;
      padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;
    }
    .src-tech { background: #dbeafe; color: #1e40af; }
    .src-biz { background: #dcfce7; color: #166534; }
    .src-mix { background: #fef3c7; color: #92400e; }
    .src-personal { background: #f3e8ff; color: #7c3aed; }
    .dark .src-tech { background: #1e3a8a; color: #93c5fd; }
    .dark .src-biz { background: #166534; color: #86efac; }
    .dark .src-mix { background: #78350f; color: #fde68a; }
    .dark .src-personal { background: #5b21b6; color: #c4b5fd; }
    
    /* æ‹–æ”¾å€åŸŸ */
    #drop-zone.drag-over {
      border-color: #d97706;
      background: rgba(217, 119, 6, 0.05);
    }
    
    /* æ–‡ä»¶é¡å‹æŒ‰éˆ• */
    .doc-type-btn {
      color: #78716c;
      background: transparent;
      border: none;
    }
    .doc-type-btn:hover {
      color: #d97706;
    }
    .doc-type-btn.active {
      background: white;
      color: #d97706;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    }
    .dark .doc-type-btn { color: #a8a29e; }
    .dark .doc-type-btn.active {
      background: #57534e;
      color: #fbbf24;
    }
    
    /* æ–‡ä»¶é …ç›® */
    .file-item:hover .upload-status { opacity: 0; }
    
    /* æŒ‰éˆ• */
    .btn-primary {
      background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
      color: white; padding: 10px 20px; border-radius: 10px;
      font-weight: 500; transition: all 0.2s ease;
    }
    .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(217,119,6,0.3); }
    
    .btn-ghost {
      padding: 8px 12px; border-radius: 8px; transition: all 0.2s ease;
      color: #57534e; background: transparent;
    }
    .btn-ghost:hover { background: rgba(0,0,0,0.05); }
    .dark .btn-ghost { color: #a8a29e; }
    .dark .btn-ghost:hover { background: rgba(255,255,255,0.08); }
    
    /* æ²è»¸ */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.15); border-radius: 3px; }
    .dark ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.15); }
    
    /* Modal */
    .modal-overlay {
      background: rgba(0,0,0,0.5); backdrop-filter: blur(4px);
    }
    .modal-content {
      background: white; border-radius: 16px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.2);
    }
    .dark .modal-content { background: #292524; }
    
    .form-input {
      width: 100%; padding: 10px 14px; border-radius: 10px;
      border: 2px solid #e7e5e4; background: #fafaf9;
      transition: all 0.2s ease;
    }
    .form-input:focus {
      outline: none; border-color: #d97706; background: white;
    }
    .dark .form-input {
      background: #1c1917; border-color: #44403c; color: white;
    }
    .dark .form-input:focus { background: #292524; }
    
    /* çŸ¥è­˜åº«é¢æ¿ */
    .kb-card {
      background: white; border: 1px solid #e7e5e4; border-radius: 12px;
      padding: 16px; transition: all 0.2s ease;
    }
    .kb-card:hover { border-color: #d97706; box-shadow: 0 4px 12px rgba(217,119,6,0.1); }
    .dark .kb-card { background: #292524; border-color: #44403c; }
    .dark .kb-card:hover { border-color: #d97706; }
  </style>
</head>

<body class="h-full bg-sand-50 dark:bg-sand-900">
  <!-- ========== ç™»å…¥é é¢ ========== -->
  <div id="login-page" class="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-sand-100 via-claude-50 to-sand-100 dark:from-sand-900 dark:via-sand-800 dark:to-sand-900">
    <div class="modal-content w-full max-w-sm p-8">
      <div class="text-center mb-6">
        <img src="/frontend/icon/logo.png" alt="SanShin AI" class="w-20 h-20 mx-auto mb-4 rounded-xl shadow-lg">
        <h1 class="text-xl font-bold text-sand-800 dark:text-sand-100">SanShin AI</h1>
        <p class="text-sand-500 text-sm mt-1">æ™ºæ…§åŠ©ç†ç³»çµ±</p>
      </div>
      
      <div class="space-y-4">
        <input id="login-account" type="text" class="form-input" placeholder="å¸³è™Ÿ" />
        <input id="login-password" type="password" class="form-input" placeholder="å¯†ç¢¼" onkeypress="if(event.key==='Enter') login()" />
        <p id="login-error" class="hidden text-red-500 text-sm text-center">å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤</p>
        <button onclick="login()" class="btn-primary w-full">ç™»å…¥</button>
      </div>
    </div>
  </div>

  <!-- ========== ä¸»é é¢ ========== -->
  <div id="chat-page" class="hidden h-full flex">
    <!-- å´é‚Šæ¬„é®ç½© -->
    <div id="sidebar-backdrop" class="hidden fixed inset-0 bg-black/40 z-40 md:hidden" onclick="closeSidebar()"></div>
    
    <!-- å´é‚Šæ¬„ -->
    <aside id="sidebar" class="fixed md:relative z-50 w-64 h-full -translate-x-full md:translate-x-0 flex flex-col bg-sand-50 dark:bg-sand-800 border-r border-sand-200 dark:border-sand-700">
      <!-- Logo -->
      <div class="p-4 border-b border-sand-200 dark:border-sand-700">
        <div class="flex items-center gap-3">
          <img src="/frontend/icon/logo.png" alt="SanShin AI" class="w-9 h-9 rounded-lg">
          <div>
            <h1 class="font-semibold text-sand-800 dark:text-sand-100">SanShin AI</h1>
          </div>
        </div>
      </div>
      
      <!-- æ–°å°è©±æŒ‰éˆ• -->
      <button onclick="newChat()" class="m-2 p-3 flex items-center gap-2 text-sm font-medium text-claude-600 dark:text-claude-400 bg-claude-50 dark:bg-claude-900/30 hover:bg-claude-100 dark:hover:bg-claude-900/50 rounded-lg transition">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
        </svg>
        æ–°å°è©±
      </button>
      
      <!-- å°è©±åˆ—è¡¨ -->
      <div class="flex-1 overflow-y-auto" id="chat-list"></div>
      
      <!-- åº•éƒ¨åŠŸèƒ½ -->
      <div class="p-3 border-t border-sand-200 dark:border-sand-700 space-y-1">
        <!-- çŸ¥è­˜åº«æŒ‰éˆ• -->
        <button onclick="openKnowledgeBase()" class="btn-ghost w-full flex items-center gap-3 text-sm">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
          </svg>
          çŸ¥è­˜åº«
        </button>
        
        <!-- æ·±è‰²æ¨¡å¼ -->
        <button id="theme-toggle" class="btn-ghost w-full flex items-center gap-3 text-sm">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
          </svg>
          <span class="dark:hidden">æ·±è‰²æ¨¡å¼</span>
          <span class="hidden dark:inline">æ·ºè‰²æ¨¡å¼</span>
        </button>
        
        <!-- ç”¨æˆ¶é¸å–® -->
        <div class="relative">
          <button onclick="toggleDropdown()" class="btn-ghost w-full flex items-center gap-3 text-sm">
            <div class="w-7 h-7 rounded-full bg-gradient-to-br from-claude-400 to-claude-600 flex items-center justify-center text-white text-xs font-medium" id="user-avatar">U</div>
            <span id="user-info-dropdown" class="flex-1 text-left truncate">ç”¨æˆ¶</span>
            <svg class="w-4 h-4 text-sand-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>
          
          <div id="user-dropdown" class="hidden absolute bottom-full left-0 right-0 mb-2 modal-content p-2 rounded-xl shadow-lg">
            <button onclick="toggleAdmin()" class="w-full text-left px-3 py-2 text-sm text-sand-700 dark:text-sand-300 hover:bg-sand-100 dark:hover:bg-sand-700 rounded-lg">å¸³è™Ÿç®¡ç†</button>
            <button onclick="changeOwnPassword()" class="w-full text-left px-3 py-2 text-sm text-sand-700 dark:text-sand-300 hover:bg-sand-100 dark:hover:bg-sand-700 rounded-lg">ä¿®æ”¹å¯†ç¢¼</button>
            <hr class="my-1 border-sand-200 dark:border-sand-600">
            <button onclick="logout()" class="w-full text-left px-3 py-2 text-sm text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg">ç™»å‡º</button>
          </div>
        </div>
      </div>
    </aside>

    <!-- ä¸»å…§å®¹ -->
    <main class="flex-1 flex flex-col h-full overflow-hidden">
      <!-- é ‚éƒ¨ -->
      <header class="flex items-center gap-3 px-4 py-3 border-b border-sand-200 dark:border-sand-700 bg-white/80 dark:bg-sand-800/80 backdrop-blur">
        <button id="sidebar-toggle" class="md:hidden btn-ghost p-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
        <h2 id="chat-title" class="font-medium text-sand-800 dark:text-sand-100 truncate flex-1">æ–°å°è©±</h2>
      </header>
      
      <!-- å°è©±å€ -->
      <div id="chat-box" class="flex-1 overflow-y-auto p-4">
        <!-- æ­¡è¿ç•«é¢ -->
        <div id="welcome-screen" class="h-full flex flex-col items-center justify-center text-center px-4">
          <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-claude-100 to-claude-200 dark:from-claude-800 dark:to-claude-700 flex items-center justify-center mb-4">
            <svg class="w-8 h-8 text-claude-600 dark:text-claude-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
            </svg>
          </div>
          <h2 class="text-xl font-semibold text-sand-800 dark:text-sand-100 mb-2">æ­¡è¿ä½¿ç”¨ SanShin AI</h2>
          <p class="text-sand-500 max-w-md mb-6 text-sm">æˆ‘å¯ä»¥å”åŠ©æ‚¨æŸ¥è©¢æŠ€è¡“æ–‡ä»¶ã€æ¥­å‹™è³‡æ–™ï¼Œæˆ–å›ç­”å„ç¨®å•é¡Œ</p>
          <div class="grid grid-cols-2 gap-3 max-w-sm w-full">
            <button onclick="setExample('MXJ4 è¦æ ¼æ˜¯ä»€éº¼ï¼Ÿ')" class="p-3 text-left rounded-xl bg-white dark:bg-sand-800 border border-sand-200 dark:border-sand-700 hover:border-claude-400 transition text-sm">
              <div class="font-medium text-sand-800 dark:text-sand-200">ğŸ”§ æŠ€è¡“æŸ¥è©¢</div>
              <div class="text-xs text-sand-500 mt-1">MXJ4 è¦æ ¼æ˜¯ä»€éº¼ï¼Ÿ</div>
            </button>
            <button onclick="setExample('åˆ—å‡ºæ±å°ç²¾æ©Ÿçš„æ´»å‹•')" class="p-3 text-left rounded-xl bg-white dark:bg-sand-800 border border-sand-200 dark:border-sand-700 hover:border-claude-400 transition text-sm">
              <div class="font-medium text-sand-800 dark:text-sand-200">ğŸ“Š æ¥­å‹™æŸ¥è©¢</div>
              <div class="text-xs text-sand-500 mt-1">åˆ—å‡ºæ±å°ç²¾æ©Ÿçš„æ´»å‹•</div>
            </button>
          </div>
        </div>
      </div>
      
      <!-- è¼¸å…¥å€ -->
      <div class="p-4 bg-white dark:bg-sand-800 border-t border-sand-200 dark:border-sand-700">
        <div class="max-w-3xl mx-auto space-y-3">
          <!-- æ¨¡å¼é¸æ“‡ -->
          <div class="flex justify-center">
            <div class="mode-selector">
              <button class="mode-btn active" data-mode="smart" onclick="setMode('smart')">ğŸ§  æ™ºæ…§</button>
              <button class="mode-btn" data-mode="technical" onclick="setMode('technical')">ğŸ”§ æŠ€è¡“</button>
              <button class="mode-btn" data-mode="business" onclick="setMode('business')">ğŸ“Š æ¥­å‹™</button>
              <button class="mode-btn" data-mode="personal" onclick="setMode('personal')">ğŸ‘¤ å€‹äºº</button>
            </div>
          </div>
          
          <!-- è¼¸å…¥æ¡† -->
          <div class="input-wrapper flex items-end gap-2 p-2">
            <textarea id="input" rows="1" class="flex-1 px-3 py-2 bg-transparent border-none outline-none resize-none text-sand-800 dark:text-sand-100 text-sm" placeholder="è¼¸å…¥å•é¡Œ..." onkeydown="handleKey(event)"></textarea>
            <button onclick="sendMessage()" class="p-2 rounded-lg bg-gradient-to-br from-claude-500 to-claude-600 text-white hover:shadow-lg transition">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
              </svg>
            </button>
          </div>
          
          <p id="mode-hint" class="text-xs text-center text-sand-400">ğŸ§  æ™ºæ…§æ¨¡å¼ï¼šAI æœƒè‡ªå‹•åˆ¤æ–·è³‡æ–™ä¾†æº</p>
        </div>
      </div>
    </main>
  </div>

  <!-- ========== çŸ¥è­˜åº«é é¢ ========== -->
  <div id="kb-page" class="hidden fixed inset-0 z-50 bg-sand-50 dark:bg-sand-900 overflow-auto">
    <div class="max-w-4xl mx-auto p-4 sm:p-6">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-xl font-bold text-sand-800 dark:text-sand-100">ğŸ“š çŸ¥è­˜åº«ç®¡ç†</h2>
        <button onclick="closeKnowledgeBase()" class="btn-ghost">âœ• é—œé–‰</button>
      </div>
      
      <!-- å€‹äººçŸ¥è­˜åº«å€å¡Š -->
      <div class="kb-card mb-6 border-2 border-blue-200 dark:border-blue-800">
        <div class="flex items-center justify-between mb-3">
          <h3 class="font-semibold text-blue-700 dark:text-blue-300">ğŸ“ æˆ‘çš„çŸ¥è­˜åº«</h3>
          <div class="flex gap-2">
            <button onclick="showNoteEditor()" class="btn-ghost text-sm border border-blue-300 dark:border-blue-600 text-blue-600">âœï¸ æ‰‹å¯«ç­†è¨˜</button>
            <label class="btn-primary text-sm bg-blue-600 hover:bg-blue-700 cursor-pointer">
              ğŸ“„ ä¸Šå‚³æ–‡ä»¶
              <input type="file" id="personal-file-upload" multiple accept=".pdf,.docx,.doc,.xlsx,.xls,.csv,.md,.txt,.rtf,.png,.jpg,.jpeg,.gif" class="hidden" onchange="handlePersonalFileUpload(event)">
            </label>
          </div>
        </div>
        <p class="text-sm text-sand-500 mb-3">ä¸Šå‚³æ–‡ä»¶æˆ–æ‰‹å¯«ç­†è¨˜ï¼ŒAI æœƒè‡ªå‹•ç´¢å¼•ã€‚æ”¯æ´ PDFã€Wordã€Excelã€CSVã€åœ–ç‰‡ç­‰æ ¼å¼ï¼Œå¯åœ¨ã€ŒğŸ‘¤ å€‹äººæ¨¡å¼ã€ä¸‹æŸ¥è©¢ã€‚</p>
        
        <!-- å€‹äººæ–‡ä»¶ä¸Šå‚³ç‹€æ…‹ -->
        <div id="personal-upload-status" class="mb-3 hidden"></div>
        
        <!-- å€‹äººçŸ¥è­˜åˆ—è¡¨ -->
        <div id="notes-list" class="space-y-2 max-h-64 overflow-y-auto">
          <p class="text-sand-400 text-sm text-center py-4">è¼‰å…¥ä¸­...</p>
        </div>
      </div>
      
      <!-- æ¥­å‹™æ—¥å ±ä¸Šå‚³ (åƒ…ç®¡ç†å“¡å¯è¦‹) -->
      <div id="admin-business-section" class="kb-card mb-6 border-2 border-purple-200 dark:border-purple-800 hidden">
        <div class="flex items-center justify-between mb-3">
          <h3 class="font-semibold text-purple-700 dark:text-purple-300">ğŸ“Š æ¥­å‹™æ—¥å ±æ›´æ–°</h3>
          <span class="text-xs bg-purple-100 dark:bg-purple-900 text-purple-600 dark:text-purple-300 px-2 py-1 rounded-full">ç®¡ç†å“¡å°ˆç”¨</span>
        </div>
        <p class="text-sm text-sand-500 mb-3">ä¸Šå‚³ Lotus Notes åŒ¯å‡ºçš„æ¥­å‹™æ—¥å ± TXTï¼Œç³»çµ±æœƒè‡ªå‹•éæ¿¾èˆŠè³‡æ–™ä¸¦æ›´æ–°ã€‚</p>
        
        <div class="flex flex-wrap gap-3 items-end">
          <div class="flex-1 min-w-[200px]">
            <input type="file" id="business-file" accept=".txt" class="hidden" onchange="handleBusinessFileSelect(event)">
            <label for="business-file" class="block w-full p-3 border-2 border-dashed border-purple-300 dark:border-purple-600 rounded-lg text-center cursor-pointer hover:border-purple-500 transition">
              <span id="business-file-name" class="text-sm text-sand-600 dark:text-sand-400">é»æ“Šé¸æ“‡ TXT æª”æ¡ˆ</span>
            </label>
          </div>
          <div class="flex items-center gap-2">
            <label class="text-sm text-sand-600 dark:text-sand-400">ä¿ç•™</label>
            <select id="months-to-keep" class="form-input w-20 py-2 text-sm">
              <option value="6">6 æœˆ</option>
              <option value="12" selected>12 æœˆ</option>
              <option value="18">18 æœˆ</option>
              <option value="24">24 æœˆ</option>
            </select>
          </div>
          <button id="upload-business-btn" onclick="uploadBusinessReport()" disabled class="btn-primary bg-purple-600 hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed">
            ğŸš€ è™•ç†ä¸¦æ›´æ–°
          </button>
        </div>
        <div id="business-upload-status" class="mt-3 text-sm hidden"></div>
      </div>
      
      <!-- å…¬ç”¨çŸ¥è­˜åº«ä¸Šå‚³ (åƒ…ç®¡ç†å“¡å¯è¦‹) -->
      <div id="admin-upload-section" class="kb-card mb-6 hidden">
        <h3 class="font-semibold text-sand-800 dark:text-sand-100 mb-3">ğŸ“¤ ä¸Šå‚³å…¬ç”¨æ–‡ä»¶ <span class="text-xs font-normal text-sand-400">ç®¡ç†å“¡å°ˆç”¨</span></h3>
        <div id="drop-zone" class="border-2 border-dashed border-sand-300 dark:border-sand-600 rounded-xl p-6 text-center transition-all hover:border-claude-400 cursor-pointer">
          <input type="file" id="file-upload" multiple accept=".pdf,.md,.txt,.docx,.doc,.xlsx,.xls,.csv,.rtf" class="hidden" onchange="handleFileSelect(event)">
          <label for="file-upload" class="cursor-pointer block">
            <svg class="w-10 h-10 mx-auto text-sand-400 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
            </svg>
            <p class="text-sand-600 dark:text-sand-400 text-sm">é»æ“Šæˆ–æ‹–æ”¾æ–‡ä»¶</p>
            <p class="text-sand-400 text-xs mt-1">æ”¯æ´ PDF, Word, Excel, CSVï¼ˆè‡ªå‹•è½‰ Markdownï¼‰</p>
          </label>
        </div>
        <div id="upload-list" class="mt-3 space-y-2"></div>
        <button id="upload-btn" onclick="uploadFiles()" class="hidden btn-primary mt-3 w-full">ğŸ“¤ é–‹å§‹ä¸Šå‚³</button>
      </div>
      
      <!-- æ–‡ä»¶åˆ—è¡¨ -->
      <div class="kb-card mb-6">
        <div class="flex items-center justify-between mb-3">
          <h3 class="font-semibold text-sand-800 dark:text-sand-100">ğŸ“ å…¬ç”¨çŸ¥è­˜åº«</h3>
          <div class="flex items-center gap-2">
            <div class="flex bg-sand-100 dark:bg-sand-700 rounded-lg p-1">
              <button class="doc-type-btn active text-xs px-3 py-1 rounded-md transition" data-type="technical" onclick="setDocType('technical')">ğŸ”§ æŠ€è¡“</button>
              <button class="doc-type-btn text-xs px-3 py-1 rounded-md transition" data-type="business" onclick="setDocType('business')">ğŸ“Š æ¥­å‹™</button>
            </div>
            <button onclick="refreshFileList()" class="btn-ghost text-sm">ğŸ”„</button>
          </div>
        </div>
        <div id="file-list" class="space-y-2 max-h-64 overflow-y-auto">
          <p class="text-sand-500 text-sm">è¼‰å…¥ä¸­...</p>
        </div>
      </div>
      
      <!-- ç³»çµ±ç‹€æ…‹ -->
      <div class="kb-card">
        <div class="flex items-center justify-between mb-3">
          <h3 class="font-semibold text-sand-800 dark:text-sand-100">ğŸ“Š ç³»çµ±ç‹€æ…‹</h3>
          <button id="reload-btn" onclick="reloadIndex()" class="btn-ghost text-sm hidden">ğŸ”„ é‡å»ºç´¢å¼•</button>
        </div>
        <div id="system-status" class="grid grid-cols-2 sm:grid-cols-4 gap-4 text-sm">
          <div class="text-center p-3 bg-sand-100 dark:bg-sand-700 rounded-lg">
            <div class="text-2xl font-bold text-claude-600" id="stat-docs">--</div>
            <div class="text-sand-500 text-xs">æŠ€è¡“æ–‡ä»¶</div>
          </div>
          <div class="text-center p-3 bg-sand-100 dark:bg-sand-700 rounded-lg">
            <div class="text-2xl font-bold text-purple-600" id="stat-biz">--</div>
            <div class="text-sand-500 text-xs">æ¥­å‹™è¨˜éŒ„</div>
          </div>
          <div class="text-center p-3 bg-sand-100 dark:bg-sand-700 rounded-lg">
            <div class="text-2xl font-bold text-blue-600" id="stat-notes">--</div>
            <div class="text-sand-500 text-xs">æˆ‘çš„ç­†è¨˜</div>
          </div>
          <div class="text-center p-3 bg-sand-100 dark:bg-sand-700 rounded-lg">
            <div class="text-2xl font-bold text-green-600" id="stat-chunks">--</div>
            <div class="text-sand-500 text-xs">ç´¢å¼•å€å¡Š</div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ===== ç­†è¨˜ç·¨è¼¯å™¨ Modal ===== -->
  <div id="note-editor-modal" class="hidden fixed inset-0 z-[60] modal-overlay flex items-center justify-center p-4">
    <div class="modal-content w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col">
      <div class="flex items-center justify-between p-4 border-b border-sand-200 dark:border-sand-700">
        <h3 id="note-editor-title" class="font-semibold text-sand-800 dark:text-sand-100">æ–°å¢ç­†è¨˜</h3>
        <button onclick="closeNoteEditor()" class="btn-ghost p-1">âœ•</button>
      </div>
      <div class="p-4 space-y-4 overflow-y-auto flex-1">
        <div>
          <label class="block text-sm font-medium text-sand-700 dark:text-sand-300 mb-1">æ¨™é¡Œ *</label>
          <input type="text" id="note-title" class="form-input w-full" placeholder="ä¾‹å¦‚ï¼šå®¢æˆ¶ A çš„ç‰¹æ®Šéœ€æ±‚">
        </div>
        <div>
          <label class="block text-sm font-medium text-sand-700 dark:text-sand-300 mb-1">å…§å®¹ * <span class="font-normal text-sand-400">(æ”¯æ´ Markdown)</span></label>
          <textarea id="note-content" rows="10" class="form-input w-full font-mono text-sm" placeholder="åœ¨é€™è£¡è¼¸å…¥æ‚¨çš„å°ˆæ¥­çŸ¥è­˜ã€å·¥ä½œå¿ƒå¾—ã€è§£æ±ºæ–¹æ¡ˆ...

æ”¯æ´ Markdown æ ¼å¼ï¼š
- **ç²—é«”** 
- æ¸…å–®é …ç›®
- `ç¨‹å¼ç¢¼`"></textarea>
        </div>
        <div>
          <label class="block text-sm font-medium text-sand-700 dark:text-sand-300 mb-1">æ¨™ç±¤ <span class="font-normal text-sand-400">(é€—è™Ÿåˆ†éš”ï¼Œæ–¹ä¾¿åˆ†é¡)</span></label>
          <input type="text" id="note-tags" class="form-input w-full" placeholder="ä¾‹å¦‚ï¼šå®¢æˆ¶, å¢Šç‰‡, é‡è¦">
        </div>
      </div>
      <div class="flex justify-end gap-2 p-4 border-t border-sand-200 dark:border-sand-700">
        <button onclick="closeNoteEditor()" class="btn-ghost">å–æ¶ˆ</button>
        <button id="save-note-btn" onclick="saveNote()" class="btn-primary">ğŸ’¾ å„²å­˜ç­†è¨˜</button>
      </div>
    </div>
  </div>

  <!-- ========== å¸³è™Ÿç®¡ç†é é¢ ========== -->
  <div id="admin-page" class="hidden fixed inset-0 z-50 bg-sand-50 dark:bg-sand-900 overflow-auto">
    <div class="max-w-4xl mx-auto p-4 sm:p-6">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-xl font-bold text-sand-800 dark:text-sand-100">ğŸ‘¥ å¸³è™Ÿç®¡ç†</h2>
        <div class="flex gap-2">
          <button id="create-user-btn" onclick="openCreateModal()" class="hidden btn-primary text-sm">â• æ–°å¢</button>
          <button onclick="closeAdmin()" class="btn-ghost">âœ• é—œé–‰</button>
        </div>
      </div>
      
      <div class="modal-content overflow-hidden">
        <table class="w-full">
          <thead class="bg-sand-100 dark:bg-sand-700">
            <tr>
              <th class="px-4 py-3 text-left text-sm font-semibold text-sand-700 dark:text-sand-200">å¸³è™Ÿ</th>
              <th class="px-4 py-3 text-left text-sm font-semibold text-sand-700 dark:text-sand-200">å§“å</th>
              <th class="px-4 py-3 text-left text-sm font-semibold text-sand-700 dark:text-sand-200">éƒ¨é–€</th>
              <th class="px-4 py-3 text-left text-sm font-semibold text-sand-700 dark:text-sand-200">è§’è‰²</th>
              <th class="px-4 py-3 text-left text-sm font-semibold text-sand-700 dark:text-sand-200">æ“ä½œ</th>
            </tr>
          </thead>
          <tbody id="user-table" class="divide-y divide-sand-200 dark:divide-sand-700"></tbody>
        </table>
      </div>
      <div id="pagination" class="flex justify-center gap-2 mt-4"></div>
    </div>
  </div>

  <!-- ========== Modals ========== -->
  
  <!-- æ–°å¢ä½¿ç”¨è€… -->
  <div id="create-modal" class="hidden fixed inset-0 z-50 modal-overlay flex items-center justify-center p-4">
    <div class="modal-content w-full max-w-sm p-6 space-y-4">
      <h3 class="text-lg font-bold text-sand-800 dark:text-sand-100">æ–°å¢ä½¿ç”¨è€…</h3>
      <input id="modal-acc" class="form-input" placeholder="å¸³è™Ÿ">
      <input id="modal-pw1" type="password" class="form-input" placeholder="å¯†ç¢¼">
      <input id="modal-pw2" type="password" class="form-input" placeholder="ç¢ºèªå¯†ç¢¼">
      <input id="modal-name" class="form-input" placeholder="å§“å">
      <select id="modal-dept" class="form-input">
        <option value="">é¸æ“‡éƒ¨é–€</option>
        <option>è‘£äº‹é•·å®¤</option><option>ç¸½ç¶“ç†å®¤</option><option>ç®¡ç†éƒ¨</option>
        <option>è²¿æ˜“èª²</option><option>æ¡è³¼</option><option>ç©ºå£“ç”¢å“ç¾¤</option>
        <option>æ²¹å£“ç”¢å“ç¾¤</option><option>æ­¢æ´©ç”¢å“ç¾¤</option><option>å°åŒ—ç‡Ÿæ¥­æ‰€</option>
        <option>å°ä¸­ç‡Ÿæ¥­æ‰€</option><option>å°å—ç‡Ÿæ¥­æ‰€</option><option>é«˜é›„ç‡Ÿæ¥­æ‰€</option>
        <option>æ¹–å…§å» </option><option>æ¹–å…§å» è£½é€ èª²</option><option>æ¹–å…§å» æ¥­å‹™èª²</option><option>å„²é‹æ‰€</option>
      </select>
      <select id="modal-role" class="form-input">
        <option value="user">user</option>
        <option value="admin">admin</option>
      </select>
      <div class="flex justify-end gap-2 pt-2">
        <button onclick="closeCreateModal()" class="btn-ghost">å–æ¶ˆ</button>
        <button onclick="submitCreateUser()" class="btn-primary">æ–°å¢</button>
      </div>
    </div>
  </div>
  
  <!-- ä¿®æ”¹å¯†ç¢¼ -->
  <div id="password-modal" class="hidden fixed inset-0 z-50 modal-overlay flex items-center justify-center p-4">
    <div class="modal-content w-full max-w-sm p-6 space-y-4">
      <h3 class="text-lg font-bold text-sand-800 dark:text-sand-100">ä¿®æ”¹å¯†ç¢¼</h3>
      <input id="pw1" type="password" class="form-input" placeholder="æ–°å¯†ç¢¼">
      <input id="pw2" type="password" class="form-input" placeholder="ç¢ºèªå¯†ç¢¼">
      <div class="flex justify-end gap-2 pt-2">
        <button onclick="closePasswordModal()" class="btn-ghost">å–æ¶ˆ</button>
        <button onclick="submitPasswordChange()" class="btn-primary">ç¢ºèª</button>
      </div>
    </div>
  </div>
  
  <!-- ä¿®æ”¹å€‹äººè³‡æ–™ -->
  <div id="edit-profile-modal" class="hidden fixed inset-0 z-50 modal-overlay flex items-center justify-center p-4">
    <div class="modal-content w-full max-w-sm p-6 space-y-4">
      <h3 class="text-lg font-bold text-sand-800 dark:text-sand-100">ä¿®æ”¹å€‹äººè³‡æ–™</h3>
      <input id="edit-name" class="form-input" placeholder="å§“å">
      <select id="edit-dept" class="form-input">
        <option>è‘£äº‹é•·å®¤</option><option>ç¸½ç¶“ç†å®¤</option><option>ç®¡ç†éƒ¨</option>
        <option>è²¿æ˜“èª²</option><option>æ¡è³¼</option><option>ç©ºå£“ç”¢å“ç¾¤</option>
        <option>æ²¹å£“ç”¢å“ç¾¤</option><option>æ­¢æ´©ç”¢å“ç¾¤</option><option>å°åŒ—ç‡Ÿæ¥­æ‰€</option>
        <option>å°ä¸­ç‡Ÿæ¥­æ‰€</option><option>å°å—ç‡Ÿæ¥­æ‰€</option><option>é«˜é›„ç‡Ÿæ¥­æ‰€</option>
        <option>æ¹–å…§å» </option><option>æ¹–å…§å» è£½é€ èª²</option><option>æ¹–å…§å» æ¥­å‹™èª²</option><option>å„²é‹æ‰€</option>
      </select>
      <div class="flex justify-end gap-2 pt-2">
        <button onclick="closeProfileModal()" class="btn-ghost">å–æ¶ˆ</button>
        <button onclick="submitEditProfile()" class="btn-primary">å„²å­˜</button>
      </div>
    </div>
  </div>
  
  <!-- ä¿®æ”¹æ¬Šé™ -->
  <div id="edit-role-modal" class="hidden fixed inset-0 z-50 modal-overlay flex items-center justify-center p-4">
    <div class="modal-content w-full max-w-sm p-6 space-y-4">
      <h3 class="text-lg font-bold text-sand-800 dark:text-sand-100">ä¿®æ”¹æ¬Šé™</h3>
      <select id="edit-role" class="form-input">
        <option value="user">user</option>
        <option value="admin">admin</option>
      </select>
      <div class="flex justify-end gap-2 pt-2">
        <button onclick="closeRoleModal()" class="btn-ghost">å–æ¶ˆ</button>
        <button onclick="submitEditRole()" class="btn-primary">å„²å­˜</button>
      </div>
    </div>
  </div>

  <script src="/frontend/script.js"></script>
</body>
</html>
